from fastapi import Request
from fastapi.responses import JSONResponse


@app.post("/api/tasks/{task_id}/pause")
async def api_pause_task(request: Request, task_id: str):
    if not check_auth(request):
        return JSONResponse({"success": False, "error": "Unauthorized"}, status_code=401)

    success = pause_task(task_id)
    if success:
        return JSONResponse({"success": True})
    return JSONResponse({"success": False, "error": "Cannot pause this task"}, status_code=400)


@app.post("/api/tasks/{task_id}/resume")
async def api_resume_task(request: Request, task_id: str):
    if not check_auth(request):
        return JSONResponse({"success": False, "error": "Unauthorized"}, status_code=401)

    success = resume_task(task_id)
    if success:
        return JSONResponse({"success": True})
    return JSONResponse({"success": False, "error": "Cannot resume this task"}, status_code=400)


@app.post("/api/tasks/{task_id}/stop")
async def api_stop_task(request: Request, task_id: str):
    if not check_auth(request):
        return JSONResponse({"success": False, "error": "Unauthorized"}, status_code=401)

    success = stop_task(task_id)
    if success:
        # Флаг остановки выставлен; парсер завершит работу и сохранит частичный результат,
        # а фронт через polling дождётся статуса COMPLETED/FAILED и перезагрузит страницу.
        return JSONResponse({"success": True})
    return JSONResponse({"success": False, "error": "Cannot stop this task"}, status_code=400)















