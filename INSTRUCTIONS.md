# Инструкция по использованию парсера отзывов

## Заполнение формы парсинга

### Обязательные поля

#### 1. Название компании
- **Описание**: Полное или частичное название компании для поиска
- **Примеры**: 
  - "Смарт Хоум"
  - "Победа"
  - "ООО Смарт Хоум"
- **Важно**: 
  - Используйте точное название, как оно указано на сайте компании
  - При выборе "Оба источника" убедитесь, что название идентично в Яндекс.Картах и 2GIS
  - Можно использовать частичное название, но это может привести к большему количеству результатов

#### 2. Email для уведомлений
- **Описание**: Email адрес для получения уведомлений о завершении парсинга
- **Формат**: Должен быть валидным email адресом (например, `user@example.com`)
- **Важно**: На этот email будет отправлено уведомление о завершении парсинга или ошибке

#### 3. Выбор источника
- **Опции**:
  - **Оба источника (Яндекс + 2GIS)**: Парсинг из обоих сервисов одновременно
  - **Яндекс.Карты**: Только Яндекс.Карты
  - **2GIS**: Только 2GIS
- **Важно**: 
  - При выборе "Оба источника" убедитесь, что название компании идентично в обоих сервисах
  - Иначе парсинг может быть некорректным или найдутся разные компании

#### 4. Область поиска
- **Опции**:
  - **Город**: Поиск в конкретном городе
  - **Страна**: Поиск по всей стране
- **Важно**: 
  - При выборе "Город" необходимо указать название города в поле "Город/Локация"
  - При выборе "Страна" можно указать несколько городов через запятую

#### 5. Город/Локация
- **Описание**: Название города или список городов для поиска
- **Примеры**:
  - "Санкт-Петербург"
  - "Москва, Санкт-Петербург, Казань" (для нескольких городов)
- **Важно**: 
  - Используйте правильное написание города (с заглавной буквы)
  - Для нескольких городов разделяйте запятыми
  - Город должен существовать в выбранном сервисе

### Необязательные поля

#### 6. Сайт компании
- **Описание**: URL сайта компании для фильтрации результатов
- **Формат**: 
  - С протоколом: `http://example.com` или `https://example.com`
  - Без протокола: `example.com` (автоматически добавится `http://`)
- **Примеры**:
  - `http://smarthome.spb.ru`
  - `https://www.example.com`
  - `example.com`
- **Важно**: 
  - Используется для фильтрации карточек по сайту
  - Если указан, будут показаны только карточки с этим сайтом
  - Если не указан, будут показаны все найденные карточки

#### 7. Имя файла результата
- **Описание**: Имя файла для сохранения результатов парсинга
- **Формат**: Имя файла без расширения (расширение `.csv` добавится автоматически)
- **Примеры**:
  - `smarthome_reviews`
  - `pobeda_parsing_2024`
- **Важно**: 
  - Если не указано, будет использовано автоматическое имя на основе названия компании и даты
  - Имя файла должно содержать только латинские буквы, цифры, дефисы и подчеркивания

## Возможные расхождения данных

### 1. Количество отзывов

**Причины расхождений:**
- **Фильтрация дубликатов**: Парсер может фильтровать дубликаты отзывов, которые видны на сайте
- **Динамическая загрузка**: Некоторые отзывы загружаются динамически при прокрутке, парсер может не дождаться загрузки всех
- **Ограничения парсера**: Парсер может обрабатывать ограниченное количество страниц пагинации
- **Ответы компании как отзывы**: На сайте ответы компании могут отображаться как отдельные отзывы, парсер их исключает

**Что делать:**
- Проверьте логи парсинга на наличие предупреждений о пропущенных отзывах
- Убедитесь, что парсер дождался полной загрузки страницы
- Проверьте, не считаются ли ответы компании как отдельные отзывы на сайте

### 2. Рейтинг

**Причины расхождений:**
- **Округление**: Парсер может округлять рейтинг до 1 знака после запятой
- **Разные источники данных**: Рейтинг может браться из разных мест (snippet, детальная страница)
- **Время обновления**: Рейтинг на сайте может обновиться после парсинга

**Что делать:**
- Небольшие расхождения (0.1-0.2) являются нормальными из-за округления
- Проверьте, какой рейтинг используется на сайте (общий или по карточке)

### 3. Среднее время ответа

**Причины расхождений:**
- **Отсутствие дат ответа**: Яндекс.Карты не всегда показывают дату ответа, в этом случае показывается процент отвеченных отзывов
- **Даты без года**: Если даты указаны без года, используется текущий год, что может привести к неточностям
- **Ошибки парсинга дат**: Некорректный формат даты на сайте может привести к ошибке парсинга

**Что делать:**
- Для Яндекс.Карты: если дата ответа недоступна, ориентируйтесь на процент отвеченных отзывов
- Для 2GIS: проверьте логи на наличие ошибок парсинга дат
- Убедитесь, что даты ответа действительно присутствуют на странице

### 4. Количество отвеченных отзывов

**Причины расхождений:**
- **Фильтрация ответов компании**: Парсер исключает ответы компании из подсчета пользовательских отзывов
- **Динамическая загрузка**: Ответы могут загружаться динамически, парсер может их не увидеть
- **Разные критерии**: Парсер может использовать другие критерии для определения "отвеченного" отзыва

**Что делать:**
- Проверьте логи на наличие сообщений о фильтрации ответов компании
- Убедитесь, что парсер дождался полной загрузки страницы с ответами
- Проверьте, как сайт определяет "отвеченный" отзыв

### 5. Положительные/отрицательные отзывы

**Причины расхождений:**
- **Классификация по рейтингу**: Парсер классифицирует отзывы по рейтингу (1-2⭐ = отрицательные, 4-5⭐ = положительные)
- **Отсутствие рейтинга**: Отзывы без рейтинга могут не учитываться в классификации
- **Разные критерии**: Сайт может использовать другие критерии для классификации

**Что делать:**
- Проверьте, как сайт классифицирует отзывы (по рейтингу или по тексту)
- Убедитесь, что все отзывы имеют рейтинг
- Проверьте логи на наличие отзывов без рейтинга

### 6. Данные карточек

**Причины расхождений:**
- **Фильтрация по сайту**: Если указан сайт компании, показываются только карточки с этим сайтом
- **Фильтрация по адресу**: Если указан адрес, показываются только карточки с этим адресом
- **Разные города**: Карточки из разных городов могут иметь разные данные

**Что делать:**
- Проверьте, правильно ли указан сайт/адрес для фильтрации
- Убедитесь, что все карточки компании имеют одинаковый сайт/адрес
- Проверьте логи на наличие сообщений о фильтрации карточек

## Рекомендации

1. **Перед парсингом:**
   - Проверьте название компании на сайте
   - Убедитесь, что название идентично в обоих сервисах (если используете оба источника)
   - Проверьте наличие сайта компании на карточках

2. **Во время парсинга:**
   - Не закрывайте браузер
   - Дождитесь завершения парсинга
   - Проверьте логи на наличие ошибок

3. **После парсинга:**
   - Проверьте результаты на соответствие данным на сайте
   - При расхождениях проверьте логи парсинга
   - Используйте фильтры в отчете для детального анализа

## Технические детали

### Ограничения парсера

- **Максимальное количество страниц пагинации**: 20 страниц на источник
- **Максимальное количество отзывов**: Ограничено настройками парсера
- **Время ожидания загрузки**: Зависит от скорости интернета и загрузки страницы
- **Обработка капчи**: Парсер может остановиться при появлении капчи

### Логирование

Все действия парсера записываются в файл `logs/parser.log`. При возникновении проблем проверьте этот файл для диагностики.

### Форматы отчетов

- **CSV**: Основной формат для сохранения результатов
- **PDF**: Отчет в формате PDF с агрегированной статистикой
- **JSON**: Полный отчет в формате JSON со всеми данными

## Поддержка

При возникновении проблем:
1. Проверьте логи парсинга (`logs/parser.log`)
2. Убедитесь, что все поля формы заполнены правильно
3. Проверьте, что название компании существует в выбранном сервисе
4. Убедитесь, что интернет-соединение стабильно

